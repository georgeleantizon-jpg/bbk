<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #3874c0; background-color: #ffffff}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #7cc8fd; background-color: #ffffff}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #b36a52; background-color: #ffffff}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #bebebe; background-color: #ffffff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #5a6065; background-color: #ffffff}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #61b670; background-color: #ffffff}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #97bb86; background-color: #ffffff}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #bebebe; background-color: #ffffff; min-height: 16.0px}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #61b670; background-color: #ffffff; min-height: 16.0px}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; -webkit-text-stroke: 0px #7cc8fd}
    span.s3 {font-kerning: none; -webkit-text-stroke: 0px #5a5a5a}
    span.s4 {font-kerning: none; -webkit-text-stroke: 0px #bebebe}
    span.s5 {font-kerning: none; -webkit-text-stroke: 0px #b36a52}
    span.s6 {font-kerning: none; -webkit-text-stroke: 0px #3874c0}
    span.s7 {font-kerning: none; -webkit-text-stroke: 0px #a651f5}
    span.s8 {font-kerning: none; -webkit-text-stroke: 0px #cacaca}
    span.s9 {font-kerning: none; -webkit-text-stroke: 0px #61b670}
    span.s10 {font-kerning: none; -webkit-text-stroke: 0px #97bb86}
    span.s11 {font-kerning: none; -webkit-text-stroke: 0px #5a6065}
    span.s12 {font-kerning: none; -webkit-text-stroke: 0px #30b68f}
    span.s13 {font-kerning: none; -webkit-text-stroke: 0px #f16625}
    span.s14 {font: 14.0px 'Apple Color Emoji'; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">BuoBuo Ka Pre-Order - Team A.N.G. A. Co.</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Load Tailwind CSS --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">@import</span><span class="s4"> </span><span class="s5">url</span><span class="s8">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s9">'Inter'</span><span class="s8">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> #f7f9fb</span><span class="s8">;</span><span class="s4"> </span><span class="s1">/* Light background */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Custom scrollbar style for better aesthetics */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.cart-list::-webkit-scrollbar</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s10">6px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.cart-list::-webkit-scrollbar-thumb</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #6366f1</span><span class="s8">;</span><span class="s1"> </span><span class="s11">/* Indigo-500 */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">3px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.step-container</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">min-height:</span><span class="s4"> </span><span class="s10">50vh</span><span class="s8">;</span><span class="s4"> </span><span class="s1">/* Ensure content is visually separated */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.card-shadow</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">10px</span><span class="s4"> </span><span class="s1">25px</span><span class="s4"> </span><span class="s1">-5px</span><span class="s4"> </span><span class="s5">rgba(</span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0.1</span><span class="s5">)</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">5px</span><span class="s4"> </span><span class="s1">10px</span><span class="s4"> </span><span class="s1">-5px</span><span class="s4"> </span><span class="s5">rgba(</span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">0.04</span><span class="s5">)</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase Imports --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> initializeApp </span><span class="s8">}</span><span class="s4"> </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getAuth</span><span class="s8">,</span><span class="s1"> signInAnonymously</span><span class="s8">,</span><span class="s1"> signInWithCustomToken </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getFirestore</span><span class="s8">,</span><span class="s1"> collection</span><span class="s8">,</span><span class="s1"> addDoc</span><span class="s8">,</span><span class="s1"> serverTimestamp</span><span class="s8">,</span><span class="s1"> setLogLevel </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Global Firebase variables provided by the Canvas environment</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> appId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __app_id </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __app_id </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'default-app-id'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> firebaseConfig </span><span class="s8">=</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">parse</span><span class="s8">(</span><span class="s7">typeof</span><span class="s1"> __firebase_config </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __firebase_config </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'{}'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> initialAuthToken </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __initial_auth_token </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __initial_auth_token </span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> db</span><span class="s8">,</span><span class="s1"> auth</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s4"> userId </span><span class="s8">=</span><span class="s4"> </span><span class="s9">'loading'</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Will be set after auth</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// App State</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> currentStep </span><span class="s8">=</span><span class="s1"> </span><span class="s13">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> orderCart </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> selectedAddOns </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> factionPromo </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> enabled</span><span class="s8">:</span><span class="s1"> </span><span class="s7">false</span><span class="s8">,</span><span class="s1"> discount</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> customerDetails </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> contact</span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> address</span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> </span><span class="s12">ADD_ONS</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'delivery'</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Delivery Service'</span><span class="s8">,</span><span class="s1"> price</span><span class="s8">:</span><span class="s1"> </span><span class="s13">150.00</span><span class="s8">,</span><span class="s1"> exclusiveGroup</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'custom_card'</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Custom Card Message'</span><span class="s8">,</span><span class="s1"> price</span><span class="s8">:</span><span class="s1"> </span><span class="s13">50.00</span><span class="s8">,</span><span class="s1"> exclusiveGroup</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'lights'</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Ferry Lights Only'</span><span class="s8">,</span><span class="s1"> price</span><span class="s8">:</span><span class="s1"> </span><span class="s13">100.00</span><span class="s8">,</span><span class="s1"> exclusiveGroup</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'lights_box'</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'box'</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Acrylic Box Only'</span><span class="s8">,</span><span class="s1"> price</span><span class="s8">:</span><span class="s1"> </span><span class="s13">150.00</span><span class="s8">,</span><span class="s1"> exclusiveGroup</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'lights_box'</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s8">{</span><span class="s4"> id</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'combo'</span><span class="s8">,</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Ferry Lights + Acrylic Box Combo'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">220.00</span><span class="s8">,</span><span class="s4"> exclusiveGroup</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'lights_box'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">];</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Design choices with placeholder images</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> </span><span class="s12">DESIGNS</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">'3D'</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Crystal Cascade'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">799.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/6366f1/ffffff?text=3D+D1'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Aurora Borealis'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">849.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/8b5cf6/ffffff?text=3D+D2'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Lunar Bloom'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">749.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/a855f7/ffffff?text=3D+D3'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Galaxy Swirl'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">999.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/c026d3/ffffff?text=3D+D4'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Ocean Depth'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">899.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/db2777/ffffff?text=3D+D5'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Ember Glow'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">799.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/e9d5ff/6366f1?text=3D+D6'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Forest Spirit'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">749.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/d1d5db/6366f1?text=3D+D7'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Desert Sun'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">849.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/9ca3af/6366f1?text=3D+D8'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Winter Frost'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">999.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/6b7280/ffffff?text=3D+D9'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Rainbow Burst'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">949.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/4b5563/ffffff?text=3D+D10'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">'2D'</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Simple Portrait'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">499.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/10b981/ffffff?text=2D+D1'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Monochrome Vibe'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">549.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/059669/ffffff?text=2D+D2'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Sketch Style'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">449.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/047857/ffffff?text=2D+D3'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Geometric Pattern'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">599.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/065f46/ffffff?text=2D+D4'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s4"> name</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Abstract Art'</span><span class="s8">,</span><span class="s4"> price</span><span class="s8">:</span><span class="s4"> </span><span class="s13">649.00</span><span class="s8">,</span><span class="s4"> image</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/150x150/064e3b/ffffff?text=2D+D5'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Initialization and Authentication ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> initFirebase</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// setLogLevel('debug'); // Uncomment for debugging</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> app </span><span class="s8">=</span><span class="s1"> initializeApp</span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>db </span><span class="s8">=</span><span class="s1"> getFirestore</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>auth </span><span class="s8">=</span><span class="s1"> getAuth</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Authenticate user</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">initialAuthToken</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInWithCustomToken</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">,</span><span class="s1"> initialAuthToken</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> signInAnonymously</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>userId </span><span class="s8">=</span><span class="s1"> auth</span><span class="s8">.</span><span class="s1">currentUser</span><span class="s8">?.</span><span class="s1">uid </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'anonymous-user'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">log</span><span class="s8">(</span><span class="s9">"Firebase initialized. User ID:"</span><span class="s8">,</span><span class="s1"> userId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Firebase initialization failed:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="p-8 text-center text-red-600 bg-red-100 rounded-lg"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>Error: Failed to initialize Firebase. Pre-ordering is disabled. Please check the console for details.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- State Management and Rendering ---</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> updateUI</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'max-w-4xl mx-auto p-4 md:p-8'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderHeader</span><span class="s8">();</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">switch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentStep</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s13">1</span><span class="s8">:</span><span class="s1"> renderStep1ChooseType</span><span class="s8">();</span><span class="s1"> </span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s13">2</span><span class="s8">:</span><span class="s1"> renderStep2ConfigureItem</span><span class="s8">();</span><span class="s1"> </span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s13">3</span><span class="s8">:</span><span class="s1"> renderStep3CartAddOns</span><span class="s8">();</span><span class="s1"> </span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s13">4</span><span class="s8">:</span><span class="s1"> renderStep4CustomerDetails</span><span class="s8">();</span><span class="s1"> </span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">case</span><span class="s1"> </span><span class="s13">5</span><span class="s8">:</span><span class="s1"> renderConfirmation</span><span class="s8">();</span><span class="s1"> </span><span class="s7">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderCartSummary</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> nextStep</span><span class="s8">(</span><span class="s1">step</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentStep </span><span class="s8">=</span><span class="s1"> step</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateUI</span><span class="s8">();</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>window</span><span class="s8">.</span><span class="s4">scrollTo</span><span class="s8">(</span><span class="s13">0</span><span class="s8">,</span><span class="s4"> </span><span class="s13">0</span><span class="s8">);</span><span class="s4"> </span><span class="s1">// Scroll to top on step change</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderHeader</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> headerHtml </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-col items-center mb-8"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h1 class="text-4xl font-extrabold text-indigo-700 tracking-tight"&gt;BuoBuo Ka Pre-Order&lt;/h1&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-lg text-gray-500 mt-2"&gt;Team A.N.G. A. Co.&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-6 w-full max-w-xl"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s4">renderProgressIndicator</span><span class="s8">()}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'afterbegin'</span><span class="s8">,</span><span class="s1"> headerHtml</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderProgressIndicator</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> steps </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s13">1</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Select Type'</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s13">2</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Configure Item'</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s13">3</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Review Cart'</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">{</span><span class="s1"> id</span><span class="s8">:</span><span class="s1"> </span><span class="s13">4</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Details'</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">];</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex justify-between items-center text-sm font-medium"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s4">steps</span><span class="s8">.</span><span class="s4">map</span><span class="s8">(</span><span class="s4">step </span><span class="s8">=&gt;</span><span class="s4"> </span><span class="s1">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-1 flex items-center </span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">&lt;=</span><span class="s4"> currentStep </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'text-indigo-600'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'text-gray-400'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="w-8 h-8 flex items-center justify-center rounded-full border-2 </span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">===</span><span class="s4"> currentStep </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'border-indigo-600 bg-indigo-50 font-bold'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">&lt;</span><span class="s4"> currentStep </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'border-indigo-600 bg-indigo-500 text-white'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'border-gray-300 bg-white'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">&lt;</span><span class="s4"> currentStep </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'✔'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> step</span><span class="s8">.</span><span class="s4">id</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="ml-2 hidden sm:inline"&gt;</span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">&lt;</span><span class="s4"> steps</span><span class="s8">.</span><span class="s4">length </span><span class="s8">?</span><span class="s4"> </span><span class="s1">`&lt;div class="flex-grow h-0.5 bg-gray-300 mx-2 </span><span class="s8">${</span><span class="s4">step</span><span class="s8">.</span><span class="s4">id </span><span class="s8">&lt;</span><span class="s4"> currentStep </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'bg-indigo-400'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'bg-gray-300'</span><span class="s8">}</span><span class="s1">"&gt;&lt;/div&gt;`</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">''</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s8">).</span><span class="s4">join</span><span class="s8">(</span><span class="s1">''</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Step 1: Choose Type (Pre-set vs Custom) ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderStep1ChooseType</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> stepContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="step-1" class="step-container bg-white p-6 rounded-xl card-shadow"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3"&gt;Step 1: Choose Order Type&lt;/h2&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="grid md:grid-cols-2 gap-6"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s4">renderChoiceCard</span><span class="s8">(</span><span class="s1">'pre-set'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Pre-set Designs'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Select from our exclusive collection of 3D and 2D designs. Quick and easy!'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'</span><span class="s14">🖼️</span><span class="s1">'</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s4">renderChoiceCard</span><span class="s8">(</span><span class="s1">'custom'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Custom Order'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Upload your own photo and specify your dimensions for a personalized BuoBuo Ka!'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'</span><span class="s14">📸</span><span class="s1">'</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> stepContent</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderChoiceCard</span><span class="s8">(</span><span class="s1">type</span><span class="s8">,</span><span class="s1"> title</span><span class="s8">,</span><span class="s1"> description</span><span class="s8">,</span><span class="s1"> icon</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div onclick="initiateOrder('</span><span class="s8">${</span><span class="s4">type</span><span class="s8">}</span><span class="s1">')"</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                     </span>class="group p-6 border-2 border-indigo-200 rounded-lg cursor-pointer hover:bg-indigo-50 transition duration-300 transform hover:scale-[1.02] card-shadow"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="text-4xl mb-3"&gt;</span><span class="s8">${</span><span class="s4">icon</span><span class="s8">}</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-bold text-indigo-700"&gt;</span><span class="s8">${</span><span class="s4">title</span><span class="s8">}</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-600 mt-1"&gt;</span><span class="s8">${</span><span class="s4">description</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button class="mt-4 px-4 py-2 text-sm font-semibold bg-indigo-600 text-white rounded-lg shadow-md group-hover:bg-indigo-700 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>Start Order</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">initiateOrder </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">type</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> type</span><span class="s8">:</span><span class="s1"> type</span><span class="s8">,</span><span class="s1"> dimension</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> design</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> image</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s13">1</span><span class="s8">,</span><span class="s1"> unitPrice</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>nextStep</span><span class="s8">(</span><span class="s13">2</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Step 2: Configure Item ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> currentOrder </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderStep2ConfigureItem</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> type </span><span class="s8">=</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">type</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> isPreSet </span><span class="s8">=</span><span class="s1"> type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'pre-set'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> stepContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="step-2" class="step-container bg-white p-6 rounded-xl card-shadow"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>Step 2: Configure Your </span><span class="s8">${</span><span class="s4">type </span><span class="s8">===</span><span class="s4"> </span><span class="s1">'pre-set'</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'Pre-set Design'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'Custom Item'</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Dimension (3D/2D) Selection --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mb-6"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="block text-lg font-medium text-gray-700 mb-2"&gt;1. Choose Dimension&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex space-x-4"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${[</span><span class="s1">'3D'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'2D'</span><span class="s8">].</span><span class="s4">map</span><span class="s8">(</span><span class="s4">dim </span><span class="s8">=&gt;</span><span class="s4"> </span><span class="s1">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button onclick="selectDimension('</span><span class="s8">${</span><span class="s4">dim</span><span class="s8">}</span><span class="s1">')"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                    </span>class="px-6 py-3 rounded-full border-2 font-semibold transition </span><span class="s8">${</span><span class="s4">currentOrder</span><span class="s8">.</span><span class="s4">dimension </span><span class="s8">===</span><span class="s4"> dim<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                        </span></span><span class="s8">?</span><span class="s4"> </span><span class="s1">'bg-indigo-600 text-white border-indigo-600 shadow-lg'</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                        </span></span><span class="s8">:</span><span class="s4"> </span><span class="s1">'bg-white text-indigo-600 border-indigo-400 hover:bg-indigo-50'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s8">${</span><span class="s4">dim</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>`</span><span class="s8">).</span><span class="s4">join</span><span class="s8">(</span><span class="s1">''</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s4">isPreSet<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">?</span><span class="s1"> renderPreSetDesigns</span><span class="s8">()</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">:</span><span class="s1"> renderCustomUpload</span><span class="s8">()}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Quantity Selector --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-8 pt-4 border-t"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="block text-lg font-medium text-gray-700 mb-2"&gt;3. Quantity&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="item-quantity" value="</span><span class="s8">${</span><span class="s4">currentOrder</span><span class="s8">.</span><span class="s4">quantity</span><span class="s8">}</span><span class="s1">" min="1" onchange="updateQuantity(this.value)"</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-32 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Action Buttons --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-8 flex justify-between"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="nextStep(1)" class="px-6 py-3 text-gray-600 font-semibold rounded-lg border hover:bg-gray-100 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>← Back</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="addItemToCart()" id="add-to-cart-btn" disabled</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>class="px-8 py-3 bg-indigo-400 text-white font-bold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>Add to Order List</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> stepContent</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateStep2ButtonState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">selectDimension </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dim</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">dimension </span><span class="s8">=</span><span class="s1"> dim</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">design </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>renderPreSetDesigns</span><span class="s8">();</span><span class="s1"> </span><span class="s11">// Re-render designs if Pre-set</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateStep2ButtonState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">selectDesign </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">designName</span><span class="s8">,</span><span class="s1"> price</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">design </span><span class="s8">=</span><span class="s1"> designName</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">=</span><span class="s1"> price</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateStep2ButtonState</span><span class="s8">();</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Re-render to highlight selection</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> designsContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'preset-designs-container'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">designsContainer</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>designsContainer</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.design-card'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">card </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">card</span><span class="s8">.</span><span class="s1">getAttribute</span><span class="s8">(</span><span class="s9">'data-design-name'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">===</span><span class="s1"> designName</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>card</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">add</span><span class="s8">(</span><span class="s1">'border-4'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'border-indigo-600'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'ring-2'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'ring-indigo-600'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>card</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">remove</span><span class="s8">(</span><span class="s1">'border-4'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'border-indigo-600'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'ring-2'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'ring-indigo-600'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">updateQuantity </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">value</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> qty </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">value</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s13">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>currentOrder</span><span class="s8">.</span><span class="s1">quantity </span><span class="s8">=</span><span class="s1"> qty </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> qty </span><span class="s8">:</span><span class="s1"> </span><span class="s13">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderPreSetDesigns</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> container </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'preset-designs-section'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>container</span><span class="s8">.</span><span class="s1">id </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'preset-designs-section'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>container</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'mb-6'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> designs </span><span class="s8">=</span><span class="s1"> </span><span class="s12">DESIGNS</span><span class="s8">[</span><span class="s1">currentOrder</span><span class="s8">.</span><span class="s1">dimension</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> isDimensionSelected </span><span class="s8">=</span><span class="s1"> </span><span class="s8">!!</span><span class="s1">currentOrder</span><span class="s8">.</span><span class="s1">dimension</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> html </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label class="block text-lg font-medium text-gray-700 mb-2"&gt;2. Select Design&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="preset-designs-container" class="grid grid-cols-2 md:grid-cols-5 gap-4"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isDimensionSelected </span><span class="s8">&amp;&amp;</span><span class="s1"> designs</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>designs</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">design</span><span class="s8">,</span><span class="s1"> index</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> isSelected </span><span class="s8">=</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">design </span><span class="s8">===</span><span class="s1"> design</span><span class="s8">.</span><span class="s1">name</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>html </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div onclick="selectDesign('</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">', </span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">price</span><span class="s8">}</span><span class="s1">)" data-design-name="</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">"</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>class="design-card p-2 rounded-lg border-2 cursor-pointer transition transform hover:scale-[1.03] </span><span class="s8">${</span><span class="s4">isSelected<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                </span></span><span class="s8">?</span><span class="s4"> </span><span class="s1">'border-indigo-600 ring-2 ring-indigo-600 bg-indigo-50'</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                </span></span><span class="s8">:</span><span class="s4"> </span><span class="s1">'border-gray-200 hover:border-indigo-400'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;img src="</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">image</span><span class="s8">}</span><span class="s1">" alt="</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">" class="w-full h-auto rounded-md object-cover mb-2"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm font-medium text-gray-800 truncate"&gt;</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-xs text-indigo-600 font-bold"&gt;₱</span><span class="s8">${</span><span class="s4">design</span><span class="s8">.</span><span class="s4">price</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentOrder</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'pre-set'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                 </span>html </span><span class="s8">+=</span><span class="s4"> </span><span class="s1">`&lt;p class="text-gray-500 col-span-5 p-4 text-center border rounded-lg bg-gray-50"&gt;Please select a dimension (3D or 2D) first to view designs.&lt;/p&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>html </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">`&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'step-2'</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> existingSection </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'preset-designs-section'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">existingSection</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>existingSection</span><span class="s8">.</span><span class="s1">outerHTML </span><span class="s8">=</span><span class="s1"> html</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'step-2'</span><span class="s8">).</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.mb-6'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'afterend'</span><span class="s8">,</span><span class="s1"> html</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderCustomUpload</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> customSection </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mt-6 mb-6"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-lg font-medium text-gray-700 mb-2"&gt;2. Upload Details &amp; Guidelines&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="p-4 border border-indigo-300 bg-indigo-50 rounded-lg"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm font-semibold text-indigo-700 mb-2"&gt;For a perfect custom BuoBuo Ka, please follow these guidelines:&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;ul class="list-disc list-inside text-sm text-gray-700 space-y-1"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;li&gt;**Photo Resolution:** Minimum 1000x1000 pixels.&lt;/li&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;li&gt;**Lighting:** Clear, even lighting. Avoid strong shadows or overexposure.&lt;/li&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;li&gt;**Focus:** Subject must be in sharp focus. Blurry photos cannot be processed.&lt;/li&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;li&gt;**File Type:** JPG or PNG only. (Max 5MB)&lt;/li&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;li&gt;**Upload Mockup:** (This is a mockup input for demonstration)&lt;/li&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/ul&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="file" id="custom-image-upload" accept="image/png, image/jpeg"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>onchange="handleCustomUpload(this.files[0])"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>class="mt-3 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Hidden field to store image info for order --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="hidden" id="custom-design-price" value="599.00"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> customSection</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">handleCustomUpload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">file</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">file</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// In a real application, you would upload this to Firebase Storage.</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// For this demo, we just record the file name and set a base price.</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">design </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`Custom (</span><span class="s8">${</span><span class="s1">file</span><span class="s8">.</span><span class="s1">name</span><span class="s8">}</span><span class="s9">)`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">image </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> file</span><span class="s8">.</span><span class="s1">name</span><span class="s8">,</span><span class="s1"> size</span><span class="s8">:</span><span class="s1"> file</span><span class="s8">.</span><span class="s1">size </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">=</span><span class="s1"> </span><span class="s13">599.00</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Base price for custom items</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">design </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">image </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateStep2ButtonState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> updateStep2ButtonState</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> btn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'add-to-cart-btn'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">btn</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> isReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentOrder</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'pre-set'</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">dimension </span><span class="s8">&amp;&amp;</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">design</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>isReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentOrder</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'custom'</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">dimension </span><span class="s8">&amp;&amp;</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">design</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>isReady </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>btn</span><span class="s8">.</span><span class="s1">disabled </span><span class="s8">=</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isReady</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s9">'bg-indigo-600'</span><span class="s8">,</span><span class="s1"> isReady</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s9">'bg-indigo-400'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isReady</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">addItemToCart </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentOrder </span><span class="s8">&amp;&amp;</span><span class="s1"> currentOrder</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>orderCart</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> </span><span class="s8">...</span><span class="s1">currentOrder</span><span class="s8">,</span><span class="s1"> cartId</span><span class="s8">:</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">.</span><span class="s1">now</span><span class="s8">()</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>currentOrder </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> type</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> dimension</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> design</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> image</span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">,</span><span class="s1"> quantity</span><span class="s8">:</span><span class="s1"> </span><span class="s13">1</span><span class="s8">,</span><span class="s1"> unitPrice</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>updateUI</span><span class="s8">();</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Reset to Step 1 after adding to cart, allowing continued shopping</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>nextStep</span><span class="s8">(</span><span class="s13">1</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s8">(</span><span class="s1">'Please finalize your selection (dimension and design/upload) before adding to the order list.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Step 3: Cart &amp; Add-ons ---</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderStep3CartAddOns</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> orderListHtml </span><span class="s8">=</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">`&lt;p class="text-center text-gray-500 py-6"&gt;Your order list is empty. Go back to Step 1 to add products.&lt;/p&gt;`</span><span class="s4"> </span><span class="s8">:</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">`&lt;div class="space-y-4 cart-list max-h-96 overflow-y-auto pr-2"&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s1">orderCart</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> renderCartItem</span><span class="s8">(</span><span class="s1">item</span><span class="s8">)).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> stepContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="step-3" class="step-container bg-white p-6 rounded-xl card-shadow"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3"&gt;Step 3: Review Order &amp; Add-ons&lt;/h2&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Order List --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mb-8"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-xl font-semibold text-indigo-700 mb-4"&gt;Your Order List (</span><span class="s8">${</span><span class="s4">orderCart</span><span class="s8">.</span><span class="s4">length</span><span class="s8">}</span><span class="s1"> Items)&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s4">orderListHtml</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Faction Promo --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-8 p-4 border-2 rounded-lg </span><span class="s8">${</span><span class="s4">factionPromo</span><span class="s8">.</span><span class="s4">enabled </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'border-green-500 bg-green-50'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'border-gray-300 bg-gray-50'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="flex items-center space-x-3 cursor-pointer"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="promo-toggle" class="form-checkbox h-5 w-5 text-indigo-600 rounded"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>onchange="toggleFactionPromo(this.checked)" </span><span class="s8">${</span><span class="s4">factionPromo</span><span class="s8">.</span><span class="s4">enabled </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'checked'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="text-lg font-medium text-gray-700"&gt;Apply Faction Promo (Buy 3 or more, get 10% off highest costing product)&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm mt-2 text-gray-600"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s4">calculateTotalItems</span><span class="s8">()</span><span class="s4"> </span><span class="s8">&gt;=</span><span class="s4"> </span><span class="s13">3</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                </span></span><span class="s8">?</span><span class="s4"> </span><span class="s1">`&lt;span class="text-green-600 font-bold"&gt;Promotion is eligible!&lt;/span&gt; Check the box to apply the discount.`</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                                </span></span><span class="s8">:</span><span class="s4"> </span><span class="s1">`You need </span><span class="s8">${</span><span class="s13">3</span><span class="s4"> </span><span class="s8">-</span><span class="s4"> calculateTotalItems</span><span class="s8">()}</span><span class="s1"> more item(s) to be eligible for the 10% discount.`</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Add-ons Section --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-8 pt-4 border-t"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-xl font-semibold text-indigo-700 mb-4"&gt;Add-ons&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="grid md:grid-cols-2 gap-4"&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s12">ADD_ONS</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">addon </span><span class="s8">=&gt;</span><span class="s1"> renderAddOn</span><span class="s8">(</span><span class="s1">addon</span><span class="s8">)).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Action Buttons --&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-10 flex justify-between"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="nextStep(1)" class="px-6 py-3 text-gray-600 font-semibold rounded-lg border hover:bg-gray-100 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>← Add More Orders</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="orderCart.length &gt; 0 ? nextStep(4) : showModal('Please add at least one item to your order list.')"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-700 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>Proceed to Details →</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> stepContent</span><span class="s8">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>updateCartSummary</span><span class="s8">();</span><span class="s4"> </span><span class="s1">// Refresh summary in case promo was toggled</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderCartItem</span><span class="s8">(</span><span class="s1">item</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex justify-between items-start p-3 bg-white border border-gray-200 rounded-lg"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="font-semibold text-gray-800"&gt;</span><span class="s8">${</span><span class="s4">item</span><span class="s8">.</span><span class="s4">design</span><span class="s8">}</span><span class="s1"> (</span><span class="s8">${</span><span class="s4">item</span><span class="s8">.</span><span class="s4">dimension</span><span class="s8">}</span><span class="s1">)&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-sm text-gray-500"&gt;Qty: </span><span class="s8">${</span><span class="s4">item</span><span class="s8">.</span><span class="s4">quantity</span><span class="s8">}</span><span class="s1"> @ ₱</span><span class="s8">${</span><span class="s4">item</span><span class="s8">.</span><span class="s4">unitPrice</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="removeItemFromCart(</span><span class="s8">${</span><span class="s4">item</span><span class="s8">.</span><span class="s4">cartId</span><span class="s8">}</span><span class="s1">)" class="text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-50 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderAddOn</span><span class="s8">(</span><span class="s1">addon</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> isSelected </span><span class="s8">=</span><span class="s1"> selectedAddOns</span><span class="s8">.</span><span class="s1">some</span><span class="s8">(</span><span class="s1">a </span><span class="s8">=&gt;</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> addon</span><span class="s8">.</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div onclick="toggleAddOn('</span><span class="s8">${</span><span class="s4">addon</span><span class="s8">.</span><span class="s4">id</span><span class="s8">}</span><span class="s1">')"<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>class="p-4 border-2 rounded-lg cursor-pointer transition </span><span class="s8">${</span><span class="s4">isSelected<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s8">?</span><span class="s4"> </span><span class="s1">'border-indigo-600 bg-indigo-50 shadow-md'</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s8">:</span><span class="s4"> </span><span class="s1">'border-gray-200 hover:border-indigo-400 bg-white'</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex justify-between items-center"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="font-medium text-gray-700"&gt;</span><span class="s8">${</span><span class="s4">addon</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="font-bold text-indigo-600"&gt;₱</span><span class="s8">${</span><span class="s4">addon</span><span class="s8">.</span><span class="s4">price</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">removeItemFromCart </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">cartId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>orderCart </span><span class="s8">=</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">filter</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">cartId </span><span class="s8">!==</span><span class="s1"> cartId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateUI</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">toggleFactionPromo </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">checked</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">calculateTotalItems</span><span class="s8">()</span><span class="s1"> </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s13">3</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>factionPromo</span><span class="s8">.</span><span class="s1">enabled </span><span class="s8">=</span><span class="s1"> checked</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>calculateTotals</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>updateUI</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>factionPromo</span><span class="s8">.</span><span class="s1">enabled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s8">(</span><span class="s4">checked</span><span class="s8">)</span><span class="s4"> showModal</span><span class="s8">(</span><span class="s1">'You must have a total quantity of 3 or more items to apply the Faction Promo.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">toggleAddOn </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">id</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> addon </span><span class="s8">=</span><span class="s1"> </span><span class="s12">ADD_ONS</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">a </span><span class="s8">=&gt;</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">addon</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> index </span><span class="s8">=</span><span class="s1"> selectedAddOns</span><span class="s8">.</span><span class="s1">findIndex</span><span class="s8">(</span><span class="s1">a </span><span class="s8">=&gt;</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> id</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">index </span><span class="s8">!==</span><span class="s1"> </span><span class="s8">-</span><span class="s13">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">// Deselect</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>selectedAddOns</span><span class="s8">.</span><span class="s1">splice</span><span class="s8">(</span><span class="s1">index</span><span class="s8">,</span><span class="s1"> </span><span class="s13">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Select and handle exclusive group</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">addon</span><span class="s8">.</span><span class="s1">exclusiveGroup</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>selectedAddOns </span><span class="s8">=</span><span class="s1"> selectedAddOns</span><span class="s8">.</span><span class="s1">filter</span><span class="s8">(</span><span class="s1">a </span><span class="s8">=&gt;</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">exclusiveGroup </span><span class="s8">!==</span><span class="s1"> addon</span><span class="s8">.</span><span class="s1">exclusiveGroup</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>selectedAddOns</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">addon</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>calculateTotals</span><span class="s8">();</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>renderStep3CartAddOns</span><span class="s8">();</span><span class="s4"> </span><span class="s1">// Re-render step 3 to update visuals</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateCartSummary</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Step 4: Customer Details ---</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderStep4CustomerDetails</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> stepContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="step-4" class="step-container bg-white p-6 rounded-xl card-shadow"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3"&gt;Step 4: Secure Pre-Order Details&lt;/h2&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;form id="customer-details-form"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="space-y-6"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s4">renderInputField</span><span class="s8">(</span><span class="s1">'Full Name'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'name'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text'</span><span class="s8">,</span><span class="s4"> customerDetails</span><span class="s8">.</span><span class="s4">name</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Juan Dela Cruz'</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s4">renderInputField</span><span class="s8">(</span><span class="s1">'Contact Number (Mobile)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'contact'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'tel'</span><span class="s8">,</span><span class="s4"> customerDetails</span><span class="s8">.</span><span class="s4">contact</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'09XX-XXXX-XXX'</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s4">renderInputField</span><span class="s8">(</span><span class="s1">'Delivery Address'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'address'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'text'</span><span class="s8">,</span><span class="s4"> customerDetails</span><span class="s8">.</span><span class="s4">address</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'House No., Street, City/Province'</span><span class="s8">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="mt-10 flex justify-between"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button type="button" onclick="nextStep(3)" class="px-6 py-3 text-gray-600 font-semibold rounded-lg border hover:bg-gray-100 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>← Back to Cart</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button type="submit" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-700 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                                </span>Submit Pre-Order</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/form&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> stepContent</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'customer-details-form'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'submit'</span><span class="s8">,</span><span class="s1"> handleFormSubmit</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderInputField</span><span class="s8">(</span><span class="s1">label</span><span class="s8">,</span><span class="s1"> id</span><span class="s8">,</span><span class="s1"> type</span><span class="s8">,</span><span class="s1"> value</span><span class="s8">,</span><span class="s1"> placeholder</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="</span><span class="s8">${</span><span class="s4">id</span><span class="s8">}</span><span class="s1">" class="block text-sm font-medium text-gray-700 mb-1"&gt;</span><span class="s8">${</span><span class="s4">label</span><span class="s8">}</span><span class="s1"> &lt;span class="text-red-500"&gt;*&lt;/span&gt;&lt;/label&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="</span><span class="s8">${</span><span class="s4">type</span><span class="s8">}</span><span class="s1">" id="</span><span class="s8">${</span><span class="s4">id</span><span class="s8">}</span><span class="s1">" name="</span><span class="s8">${</span><span class="s4">id</span><span class="s8">}</span><span class="s1">" value="</span><span class="s8">${</span><span class="s4">value</span><span class="s8">}</span><span class="s1">" placeholder="</span><span class="s8">${</span><span class="s4">placeholder</span><span class="s8">}</span><span class="s1">" required</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>oninput="customerDetails.</span><span class="s8">${</span><span class="s4">id</span><span class="s8">}</span><span class="s1"> = this.value"</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleFormSubmit</span><span class="s8">(</span><span class="s1">event</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>event</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> form </span><span class="s8">=</span><span class="s1"> event</span><span class="s8">.</span><span class="s1">target</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>customerDetails </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>name</span><span class="s8">:</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">name</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>contact</span><span class="s8">:</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">contact</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>address</span><span class="s8">:</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">address</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">()</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">Object</span><span class="s8">.</span><span class="s1">values</span><span class="s8">(</span><span class="s1">customerDetails</span><span class="s8">).</span><span class="s1">some</span><span class="s8">(</span><span class="s1">val </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">!</span><span class="s1">val</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s8">(</span><span class="s1">'Please fill in all required customer details.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Lock the button and show loading</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> submitBtn </span><span class="s8">=</span><span class="s1"> form</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'button[type="submit"]'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>submitBtn</span><span class="s8">.</span><span class="s1">disabled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>submitBtn</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'Securing Order...'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">await</span><span class="s1"> saveOrder</span><span class="s8">();</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>submitBtn</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'Submit Pre-Order'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>submitBtn</span><span class="s8">.</span><span class="s1">disabled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Calculations and Summary ---</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> calculateTotalItems</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">reduce</span><span class="s8">((</span><span class="s1">total</span><span class="s8">,</span><span class="s1"> item</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> total </span><span class="s8">+</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">,</span><span class="s1"> </span><span class="s13">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> calculateTotals</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> subTotal </span><span class="s8">=</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">reduce</span><span class="s8">((</span><span class="s1">total</span><span class="s8">,</span><span class="s1"> item</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> total </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">item</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">*</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">),</span><span class="s1"> </span><span class="s13">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> addonsTotal </span><span class="s8">=</span><span class="s1"> selectedAddOns</span><span class="s8">.</span><span class="s1">reduce</span><span class="s8">((</span><span class="s1">total</span><span class="s8">,</span><span class="s1"> addon</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> total </span><span class="s8">+</span><span class="s1"> addon</span><span class="s8">.</span><span class="s1">price</span><span class="s8">,</span><span class="s1"> </span><span class="s13">0</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> discount </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">factionPromo</span><span class="s8">.</span><span class="s1">enabled </span><span class="s8">&amp;&amp;</span><span class="s1"> calculateTotalItems</span><span class="s8">()</span><span class="s1"> </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s13">3</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Find the highest unit price item</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> highestPriceItem </span><span class="s8">=</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">reduce</span><span class="s8">((</span><span class="s1">max</span><span class="s8">,</span><span class="s1"> item</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">(</span><span class="s1">item</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">&gt;</span><span class="s1"> max</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">?</span><span class="s1"> item </span><span class="s8">:</span><span class="s1"> max</span><span class="s8">),</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> unitPrice</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 10% discount on the highest unit price</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>discount </span><span class="s8">=</span><span class="s1"> highestPriceItem</span><span class="s8">.</span><span class="s1">unitPrice </span><span class="s8">*</span><span class="s1"> </span><span class="s13">0.10</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>factionPromo</span><span class="s8">.</span><span class="s1">discount </span><span class="s8">=</span><span class="s1"> discount</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span>factionPromo</span><span class="s8">.</span><span class="s1">discount </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> grandTotal </span><span class="s8">=</span><span class="s1"> subTotal </span><span class="s8">+</span><span class="s1"> addonsTotal </span><span class="s8">-</span><span class="s1"> discount</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>subTotal</span><span class="s8">:</span><span class="s1"> subTotal</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addonsTotal</span><span class="s8">:</span><span class="s1"> addonsTotal</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>discount</span><span class="s8">:</span><span class="s1"> discount</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>grandTotal</span><span class="s8">:</span><span class="s1"> grandTotal </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> grandTotal </span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderCartSummary</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totals </span><span class="s8">=</span><span class="s1"> calculateTotals</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> summaryHtml </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="cart-summary" class="fixed right-0 top-0 h-full w-full sm:w-80 bg-white border-l p-4 shadow-2xl z-20 overflow-y-auto hidden lg:block"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2"&gt;Order Summary&lt;/h3&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-1 text-sm"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between"&gt;&lt;span&gt;Total Items:&lt;/span&gt;&lt;span class="font-semibold"&gt;</span><span class="s8">${</span><span class="s4">calculateTotalItems</span><span class="s8">()}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between"&gt;&lt;span&gt;Items Subtotal:&lt;/span&gt;&lt;span&gt;₱</span><span class="s8">${</span><span class="s4">totals</span><span class="s8">.</span><span class="s4">subTotal</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between"&gt;&lt;span&gt;Add-ons Total:&lt;/span&gt;&lt;span&gt;₱</span><span class="s8">${</span><span class="s4">totals</span><span class="s8">.</span><span class="s4">addonsTotal</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between text-red-600 font-semibold border-t pt-2"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;Faction Promo Discount:&lt;/span&gt;&lt;span&gt;- ₱</span><span class="s8">${</span><span class="s4">totals</span><span class="s8">.</span><span class="s4">discount</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-4 pt-4 border-t-2 border-indigo-200"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between text-xl font-extrabold text-indigo-800"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;Grand Total:&lt;/span&gt;&lt;span&gt;₱</span><span class="s8">${</span><span class="s4">totals</span><span class="s8">.</span><span class="s4">grandTotal</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">)}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s1">orderCart</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> currentStep </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s13">4</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="nextStep(3)" class="mt-6 w-full py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition shadow-lg"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>Go to Cart &amp; Checkout (</span><span class="s8">${</span><span class="s4">calculateTotalItems</span><span class="s8">()}</span><span class="s1">)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>`</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">''</span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> summaryElement </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'cart-summary'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">summaryElement</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app-container'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> summaryHtml</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>summaryElement </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'cart-summary'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>summaryElement</span><span class="s8">.</span><span class="s1">outerHTML </span><span class="s8">=</span><span class="s1"> summaryHtml</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Replaces the entire summary block</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Firebase/Data Saving Function ---</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> saveOrder</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">db</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s8">(</span><span class="s1">'Database error: Firebase is not initialized. Cannot save order.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totals </span><span class="s8">=</span><span class="s1"> calculateTotals</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> orderRefId </span><span class="s8">=</span><span class="s1"> generateOrderId</span><span class="s8">();</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> finalOrderData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>orderId</span><span class="s8">:</span><span class="s1"> orderRefId</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>userId</span><span class="s8">:</span><span class="s1"> userId</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>timestamp</span><span class="s8">:</span><span class="s1"> serverTimestamp</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>customer</span><span class="s8">:</span><span class="s1"> customerDetails</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>items</span><span class="s8">:</span><span class="s1"> orderCart</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>type</span><span class="s8">:</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">type</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>dimension</span><span class="s8">:</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">dimension</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>design</span><span class="s8">:</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">design</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>quantity</span><span class="s8">:</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">quantity</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>unitPrice</span><span class="s8">:</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">unitPrice</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">})),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addons</span><span class="s8">:</span><span class="s1"> selectedAddOns</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">addon </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>name</span><span class="s8">:</span><span class="s1"> addon</span><span class="s8">.</span><span class="s1">name</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>price</span><span class="s8">:</span><span class="s1"> addon</span><span class="s8">.</span><span class="s1">price</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">})),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>summary</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>totalItems</span><span class="s8">:</span><span class="s1"> calculateTotalItems</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>subTotal</span><span class="s8">:</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">subTotal</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>addonsTotal</span><span class="s8">:</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">addonsTotal</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>discount</span><span class="s8">:</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">discount</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>grandTotal</span><span class="s8">:</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">grandTotal</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>factionPromoApplied</span><span class="s8">:</span><span class="s1"> factionPromo</span><span class="s8">.</span><span class="s1">enabled </span><span class="s8">&amp;&amp;</span><span class="s1"> factionPromo</span><span class="s8">.</span><span class="s1">discount </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Mandatory collection path for public/collaborative data</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s4"> collectionPath </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`artifacts/</span><span class="s8">${</span><span class="s4">appId</span><span class="s8">}</span><span class="s1">/public/data/buobuoka_preorders`</span><span class="s8">;</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> addDoc</span><span class="s8">(</span><span class="s1">collection</span><span class="s8">(</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> collectionPath</span><span class="s8">),</span><span class="s1"> finalOrderData</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s4">log</span><span class="s8">(</span><span class="s1">"Order successfully written to Firestore with ID:"</span><span class="s8">,</span><span class="s4"> orderRefId</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Proceed to confirmation screen</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s9">'lastOrderId'</span><span class="s8">,</span><span class="s1"> orderRefId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s9">'lastOrderTotal'</span><span class="s8">,</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">grandTotal</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s13">2</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>orderCart </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"> </span><span class="s11">// Clear the cart</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>selectedAddOns </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"> </span><span class="s11">// Clear add-ons</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>nextStep</span><span class="s8">(</span><span class="s13">5</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error securing pre-order: "</span><span class="s8">,</span><span class="s1"> e</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s8">(</span><span class="s1">'Failed to secure your pre-order. Please check your connection or contact support.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> generateOrderId</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">'BK-'</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s12">Math</span><span class="s8">.</span><span class="s1">random</span><span class="s8">().</span><span class="s1">toString</span><span class="s8">(</span><span class="s13">36</span><span class="s8">).</span><span class="s1">substr</span><span class="s8">(</span><span class="s13">2</span><span class="s8">,</span><span class="s1"> </span><span class="s13">9</span><span class="s8">).</span><span class="s1">toUpperCase</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Confirmation Screen ---</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> renderConfirmation</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> orderId </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s9">'lastOrderId'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'N/A'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> grandTotal </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s9">'lastOrderTotal'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'N/A'</span><span class="s8">;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> confirmationHtml </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="step-container bg-white p-12 rounded-xl card-shadow text-center"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="text-6xl text-green-500 mb-4"&gt;</span><span class="s14">🎉</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-3xl font-bold text-gray-800 mb-4"&gt;Pre-Order Secured!&lt;/h2&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-lg text-gray-600 mb-6"&gt;Thank you for ordering BuoBuo Ka from Team A.N.G. A. Co.&lt;/p&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="inline-block p-4 bg-indigo-50 border-l-4 border-indigo-600 rounded-lg shadow-inner mb-8"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-lg font-semibold text-indigo-800"&gt;Your Order Reference ID:&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-4xl font-extrabold text-indigo-700"&gt;</span><span class="s8">${</span><span class="s4">orderId</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-lg font-semibold text-indigo-800 mt-2"&gt;Total Amount Due: ₱</span><span class="s8">${</span><span class="s4">grandTotal</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-sm text-gray-500 mb-8"&gt;A member of our team will contact you shortly to confirm payment and delivery details.&lt;/p&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="nextStep(1)" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-700 transition"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>Place New Order</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> confirmationHtml</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Modal/Alert Function (Replaces alert()) ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">showModal </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">message</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modal </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'custom-modal'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'modal-message'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> message</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>modal</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">hideModal </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'custom-modal'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- App Start ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Setup Modal HTML</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'app-container'</span><span class="s8">).</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="custom-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-sm"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h4 class="text-xl font-bold text-red-600 mb-4"&gt;Error / Attention&lt;/h4&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p id="modal-message" class="text-gray-700 mb-6"&gt;&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="hideModal()" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span>OK</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s8">);</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>initFirebase</span><span class="s8">().</span><span class="s1">then</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>updateUI</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">};</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Main container includes space for the fixed summary sidebar --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"lg:flex"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Main Content Area --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">main</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow lg:mr-80"</span><span class="s3">&gt;&lt;/</span><span class="s6">main</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1"></span><br></p>
</body>
</html>
